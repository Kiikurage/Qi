(function(m){function l(a){this.headers=n(a.getAllResponseHeaders());this.body=a.responseText;this.xhr=a}function n(a){var b={};a.split("\n").forEach(function(a){a=a.split(":");""!==a[0]&&(b[a[0]]=a[1])});return b}function e(a,b,c){if(!(this instanceof e))return new e(a,b);this.data=b||null;this.delegate=c;console.log(a.xhr.getResponseHeader("Link"))}function h(a){if(!(this instanceof h))return new h(a);if(a instanceof h)return a;this.body=a.body||null;this.coediting="boolean"===typeof a.coediting?
a.coediting:!1;this.id=a.id||null;this["private"]="boolean"===typeof a["private"]?a["private"]:!1;this.tags=a.tags instanceof Array?a.tags.map(k):[];this.title=a.title||null;this.user=a.user?f(a.user):null}function g(a){if(!(this instanceof g))return new g(a);if(a instanceof g)return a;this.body=a.body||null;this.id=a.id||null;this.user=f(a.user)}function f(a){if(!(this instanceof f))return new f(a);if(a instanceof f)return a;this.description=a.description||null;this.facebook_id=a.facebook_id||null;
this.followees_count=a.followees_count||null;this.followers_count=a.followers_count||null;this.id=a.id||null;this.items_count=a.items_count||null;this.linkedin_id=a.linkedin_id||null;this.location=a.location||null;this.name=a.name||null;this.organization=a.organization||null;this.profile_image_url=a.profile_image_url||null;this.twitter_screen_name=a.twitter_screen_name||null;this.website_url=a.website_url||null}function k(a){if(!(this instanceof k))return new k(a);if(a instanceof k)return a;this.followers_count=
a.followers_count||0;this.icon_url=a.icon_url||null;this.id=a.id||null;this.items_count=a.items_count||0}var b={init:function(a){a.token&&(b.accessToken_=a.token);b.clientId_=a.clientId;b.clientSecret_=a.clientSecret;if(!b.clientId_||!b.clientSecret_)throw Error("Qi.init() must be called with params.clientID and parms.clientSecret.");},clientId_:null,clientSecret_:null,accessToken_:null,authorize:function(a){a=b.extend({read:!0,write:!0,newWindow:!1});var d=[];a.read&&d.push("read_qiita");a.write&&
d.push("write_qiita");d=document.location.href="https://qiita.com/api/v2/oauth/authorize?"+b.encodeURIParam({client_id:CLIENT_ID,scope:d.join(" ")});a.newWindow?window.open(d):document.location.href=d},getToken:function(a){return b.post("https://qiita.com/api/v2/access_tokens",{client_id:b.clientId_,client_secret:b.clientSecret_,code:a}).then(function(a){b.accessToken_=a.json().token;return a})},deleteToken:function(a){return b["delete"]("https://qiita.com/api/v2/access_tokens"+b.accessToken_).then(function(a){b.accessToken_=
null;return a})},get:function(a,d,c){d&&(a+="?"+b.encodeURIParam(d));b.accessToken_&&(c=c||{},c.Authorization="Bearer "+b.accessToken_);return b.ajax("GET",a,c,null)},post:function(a,d,c){b.accessToken_&&(c=c||{},c.Authorization="Bearer "+b.accessToken_);return b.ajax("POST",a,b.extend({Accept:"application/json","Content-Type":"application/json"},c),JSON.stringify(d))},put:function(a,d,c){b.accessToken_&&(c=c||{},c.Authorization="Bearer "+b.accessToken_);return b.ajax("PUT",a,b.extend({Accept:"application/json",
"Content-Type":"application/json"},c),JSON.stringify(d))},patch:function(a,d,c){return b.ajax("PATCH",a,b.extend({Accept:"application/json","Content-Type":"application/json"},c),JSON.stringify(d))},"delete":function(a,d,c){b.accessToken_&&(c=c||{},c.Authorization="Bearer "+b.accessToken_);return b("DELETE",a,c,null)},ajax:function(a,b,c,e){var f=new XMLHttpRequest,g=Promise.defer();f.open(a,b,!0);c&&Object.keys(c).forEach(function(a){f.setRequestHeader(a,c[a])});f.addEventListener("load",function(){g.resolve(new l(f))});
f.addEventListener("error",function(){g.reject(f)});f.send(e);return g.promise},encodeURIParam:function(a){var b=[];Object.keys(a).forEach(function(c){b.push(c+"="+encodeURIComponent(a[c]))});return b.join("&")},extend:function(a,b){Array.prototype.slice.call(arguments,1).forEach(function(b){for(var d in b)a[d]=b[d]});return a}};l.prototype.json=function(){return JSON.parse(this.body)};e.prototype.first=function(){return this.iterate(this.firstURL)};e.prototype.prev=function(){return this.iterate(this.prevURL)};
e.prototype.next=function(){return this.iterate(this.nextURL)};e.prototype.last=function(){return this.iterate(this.lastURL)};e.iterate=function(a,d){if(null===a)throw Error("Can not iterate more.");return b.get(a).then(function(a){return new e(a,d(a),d)})};b.getItems=function(){return e.iterate("https://qiita.com/api/v2/items",function(a){return a.json().map(h)})};b.createItem=function(){throw Error("N.I.Y.");};b.getItemById=function(a){return b.get("https://qiita.com/api/v2/items/"+a,null,null).then(function(a){return h(a.json())})};
b.updateItem=function(){throw Error("N.I.Y.");};b.deleteItem=function(){throw Error("N.I.Y.");};b.addStock=function(a){b.put("https://qiita.com/api/v2/items/"+a+"/stock",null,null)};b.deleteStock=function(a){b["delete"]("https://qiita.com/api/v2/items/"+a+"/stock",null,null)};b.addStock=function(a){b.put("https://qiita.com/api/v2/items/"+a+"/lgtm",null,null)};b.deleteStock=function(a){b["delete"]("https://qiita.com/api/v2/items/"+a+"/lgtm",null,null)};h.prototype.getComments=function(){return e.iterate("https://qiita.com/api/v2/items/"+
this.id+"/comments",function(a){return a.json().map(g)})};h.prototype.getStockers=function(){return e.iterate("https://qiita.com/api/v2/items/"+this.id+"/stockers",function(a){return a.json().map(f)})};b.Item=h;b.getCommentById=function(a){return b.get("https://qiita.com/api/v2/comments/"+a,null,null).then(function(a){return g(a.json())})};b.removeCommentById=function(a){return b["delete"]("https://qiita.com/api/v2/comments/"+a)};b.updateCommentById=function(a,d){return b.patch("https://qiita.com/api/v2/comments/"+
a,{body:d})};b.getCommentsByItemId=function(a){return e.iterate("https://qiita.com /api/v2/items/"+a+"/comments",function(a){return a.json().map(g)})};b.setThankById=function(a){return b.put("https://qiita.com/api/v2/comments/"+a+"/thank")};b.removeThankById=function(a){return b["delete"]("https://qiita.com/api/v2/comments/"+a+"/thank")};g.prototype.remove=function(){return b.removeCommentById(this.id)};g.prototype.update=function(a){var d=this;return b.updateCommentById(this.id,a).then(function(a){d.updateLocalValue(a.json());
return a})};g.prototype.setThank=function(){return b.setThankById(this.id)};g.prototype.removeThank=function(){return b.removeThankById(this.id)};g.prototype.updateLocalValue=function(a){a={};this.body=a.body||this.body;this.id=a.id||this.id;this.user&&this.user.updateLocalValue(a.user)};b.Comment=g;b.getUsers=function(){return e.iterate("https://qiita.com/api/v2/users",function(a){return a.json().map(f)})};b.getUserById=function(a){return b.get("https://qiita.com/api/v2/users/"+a,null,null).then(function(a){return f(a.json())})};
b.getTokenUser=function(){return b.get("https://qiita.com/api/v2/authenticated_user",null,null).then(function(a){return f(a.json())})};b.getFolloweesById=function(a){return e.iterate("https://qiita.com/api/v2/users/"+a+"/followees",function(a){return a.json().map(f)})};b.getFollowersById=function(a){return e.iterate("https://qiita.com/api/v2/users/"+a+"/followers",function(a){return a.json().map(f)})};b.getItemsByUser=function(a){return e.iterate("https://qiita.com/api/v2/users/"+a+"/items",function(a){return a.json().map(h)})};
b.getItemsByUser=function(a){return e.iterate("https://qiita.com/api/v2/users/"+a+"/stockes",function(a){return a.json().map(h)})};b.User=f;b.getTags=function(){return e.iterate("https://qiita.com/api/v2/tags/",function(a){return a.json().map(k)})};b.getTag=function(a){return b.get("https://qiita.com/api/v2/tags/"+a,null,null)};b.getFollowingTags=function(a){return e.iterate("https://qiita.com/api/v2/comments/"+a+"/following_tags",function(a){return a.json().map(k)})};b.getItemsByTag=function(a){return e.iterate("https://qiita.com/api/v2/tags/"+
a+"/id",function(a){return a.json().map(h)})};b.Tag=k;m.Qi=b})(this);